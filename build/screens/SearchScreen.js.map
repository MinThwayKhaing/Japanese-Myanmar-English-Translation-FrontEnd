{"version":3,"file":"SearchScreen.js","sourceRoot":"","sources":["../../src/screens/SearchScreen.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport {\r\n  View,\r\n  Text,\r\n  TextInput,\r\n  FlatList,\r\n  TouchableOpacity,\r\n  Image,\r\n  ActivityIndicator,\r\n  StyleSheet,\r\n  KeyboardAvoidingView,\r\n  Platform,\r\n} from 'react-native';\r\nimport AsyncStorage from '@react-native-async-storage/async-storage';\r\nimport { WordService } from '../services/wordService';\r\nimport { UserService } from '../services/UserService';\r\nimport { useNavigation, useFocusEffect } from '@react-navigation/native';\r\nimport Icon from 'react-native-vector-icons/MaterialCommunityIcons';\r\n\r\nexport default function SearchScreen() {\r\n  const navigation = useNavigation<any>();\r\n  const [query, setQuery] = useState('');\r\n  const [results, setResults] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [favorites, setFavorites] = useState<string[]>([]);\r\n  const isMounted = useRef(true); // for safe cleanup\r\n\r\n  // ✅ Fetch favorites when screen is focused\r\n  useFocusEffect(\r\n    React.useCallback(() => {\r\n      let isActive = true;\r\n\r\n      const fetchFavorites = async () => {\r\n        const token = await AsyncStorage.getItem('token');\r\n        if (!token) return;\r\n        try {\r\n          const favs = await UserService.getFavorites(token);\r\n          if (isActive && Array.isArray(favs)) {\r\n            setFavorites(favs.map((f: any) => f.id));\r\n          }\r\n        } catch (err) {\r\n          console.error('Error loading favorites:', err);\r\n        }\r\n      };\r\n\r\n      fetchFavorites();\r\n\r\n      return () => {\r\n        isActive = false;\r\n      };\r\n    }, [navigation])\r\n  );\r\n\r\n  // ✅ Handle search query\r\n  useEffect(() => {\r\n    if (query.trim() === '') {\r\n      setResults([]);\r\n      return;\r\n    }\r\n\r\n    const timeout = setTimeout(async () => {\r\n      if (!isMounted.current) return;\r\n      setLoading(true);\r\n      try {\r\n        const data = await WordService.searchWords(query);\r\n        if (isMounted.current) {\r\n          setResults(Array.isArray(data) ? data : []);\r\n        }\r\n      } catch (error) {\r\n        console.error('Search error:', error);\r\n        if (isMounted.current) setResults([]);\r\n      } finally {\r\n        if (isMounted.current) setLoading(false);\r\n      }\r\n    }, 400);\r\n\r\n    return () => clearTimeout(timeout);\r\n  }, [query]);\r\n\r\n  // ✅ Toggle favorite handler\r\n  const toggleFavorite = async (wordId: string) => {\r\n    const token = await AsyncStorage.getItem('token');\r\n    if (!token) {\r\n      alert('Please log in to save favorites');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      if (favorites.includes(wordId)) {\r\n        await UserService.removeFavorite(wordId, token);\r\n        setFavorites((prev) => prev.filter((id) => id !== wordId));\r\n      } else {\r\n        await UserService.addFavorite(wordId, token);\r\n        setFavorites((prev) => [...prev, wordId]);\r\n      }\r\n    } catch (err) {\r\n      console.error('Favorite toggle failed:', err);\r\n    }\r\n  };\r\n\r\n  // ✅ Cleanup memory when screen unmounts\r\n  useEffect(() => {\r\n    return () => {\r\n      isMounted.current = false;\r\n      setQuery('');\r\n      setResults([]);\r\n      setFavorites([]);\r\n      setLoading(false);\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <KeyboardAvoidingView\r\n      style={styles.container}\r\n      behavior={Platform.OS === 'ios' ? 'padding' : undefined}\r\n    >\r\n      <Image source={require('../../assets/logo.png')} style={styles.logo} />\r\n\r\n      <TextInput\r\n        placeholder=\"Search Japanese, English, or Myanmar...\"\r\n        placeholderTextColor=\"#888\"\r\n        style={styles.input}\r\n        value={query}\r\n        onChangeText={setQuery}\r\n      />\r\n\r\n      {loading && <ActivityIndicator size=\"large\" color=\"#1A374D\" style={{ marginTop: 20 }} />}\r\n\r\n      {!loading && results.length === 0 && query !== '' && (\r\n        <Text style={styles.noResult}>No results found for \"{query}\"</Text>\r\n      )}\r\n\r\n      <FlatList\r\n        data={results}\r\n        keyExtractor={(item, index) => item.id || index.toString()}\r\n        renderItem={({ item }) => {\r\n          const isFav = favorites.includes(item.id);\r\n          return (\r\n            <View style={styles.card}>\r\n              <TouchableOpacity\r\n                activeOpacity={0.8}\r\n                style={{ flex: 1 }}\r\n                onPress={() => navigation.navigate('UserWordDetail', { id: item.id })}\r\n              >\r\n                <View style={styles.wordContainer}>\r\n                  <Text style={styles.japaneseText}>\r\n                    {item.japanese}\r\n                    {item.subTerm ? <Text style={styles.subTermText}>（{item.subTerm}）</Text> : null}\r\n                  </Text>\r\n                  {item.myanmar ? <Text style={styles.myanmarText}>{item.myanmar}</Text> : null}\r\n                  {item.english ? <Text style={styles.englishText}>{item.english}</Text> : null}\r\n                </View>\r\n              </TouchableOpacity>\r\n\r\n              <TouchableOpacity onPress={() => toggleFavorite(item.id)}>\r\n                <Icon\r\n                  name={isFav ? 'heart' : 'heart-outline'}\r\n                  size={26}\r\n                  color={isFav ? '#E63946' : '#999'}\r\n                  style={{ marginLeft: 8 }}\r\n                />\r\n              </TouchableOpacity>\r\n            </View>\r\n          );\r\n        }}\r\n      />\r\n    </KeyboardAvoidingView>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: { flex: 1, backgroundColor: '#FDFBF6', padding: 16 },\r\n  logo: { width: 80, height: 80, borderRadius: 40, alignSelf: 'center', marginVertical: 30 },\r\n  input: {\r\n    backgroundColor: '#fff',\r\n    borderColor: '#ccc',\r\n    borderWidth: 1,\r\n    borderRadius: 20,\r\n    paddingHorizontal: 15,\r\n    paddingVertical: 8,\r\n    fontSize: 15,\r\n    marginBottom: 10,\r\n  },\r\n  noResult: { textAlign: 'center', color: '#999', marginTop: 20 },\r\n  card: {\r\n    backgroundColor: '#fff',\r\n    borderRadius: 12,\r\n    padding: 16,\r\n    marginVertical: 6,\r\n    elevation: 2,\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'space-between',\r\n  },\r\n  wordContainer: { alignItems: 'flex-start', flex: 1 },\r\n  japaneseText: { fontSize: 24, fontWeight: 'bold', color: '#1A374D' },\r\n  subTermText: { fontSize: 16, color: '#666', fontWeight: '400' },\r\n  myanmarText: { fontSize: 18, color: '#333', marginTop: 6 },\r\n  englishText: { fontSize: 17, color: '#555', marginTop: 4 },\r\n});\r\n"]}